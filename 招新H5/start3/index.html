<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>病毒袭击！红岩重启计划</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app" class="page3-container">

        <!-- 内容区域 -->
        <div class="content">
            <div class="scene-text">
                往常这个时间，各部门的工位该是此起彼伏的讨论声，今天却一片混乱，每个人都对着屏幕皱眉，空气里飘着若有若无的代码报错提示音。
            </div>
            <div class="computer-area" @click="handleComputerClick">
                <div class="computer-icon"></div>
            </div>
        </div>

        <!-- 音乐控制按钮 -->
        <button class="music-btn" @click="toggleMusic">
            <i class="fa fa-music text-xl" :class="isPlaying ? 'spin-animation' : ''"></i>
        </button>
        <!-- 音频元素（隐藏控制，通过Vue管理） -->
        <audio ref="bgMusic" loop>
            <source src="/musics/配乐文件1-悬疑.MP3" type="audio/mpeg">
            您的浏览器不支持音频播放
        </audio>
    </div>

    <script>
        const { createApp, ref, onMounted, onUnmounted } = Vue;
        createApp({
            setup() {
                // 音乐状态管理
                const bgMusic = ref(null);
                const isPlaying = ref(false);

                // 页面加载时恢复音乐状态
                onMounted(() => {
                    // 从本地存储读取音乐状态
                    const savedState = JSON.parse(localStorage.getItem('musicState') || '{"isPlaying": false, "currentTime": 0}');
                    isPlaying.value = savedState.isPlaying;

                    // 等待音频加载完成后恢复进度
                    if (bgMusic.value) {
                        bgMusic.value.addEventListener('loadedmetadata', () => {
                            bgMusic.value.currentTime = savedState.currentTime;
                            if (isPlaying.value) {
                                bgMusic.value.play().catch(err => {
                                    console.log('需用户交互后播放:', err);
                                    isPlaying.value = false;
                                });
                            }
                        });
                    }
                });

                // 页面离开时保存音乐状态
                onUnmounted(() => {
                    if (bgMusic.value) {
                        localStorage.setItem('musicState', JSON.stringify({
                            isPlaying: isPlaying.value,
                            currentTime: bgMusic.value.currentTime
                        }));
                    }
                });

                // 返回上一页（page2）
                const goBack = () => {
                    window.location.href = "../page2/index.html";
                };

                // 切换音乐播放/暂停
                const toggleMusic = () => {
                    isPlaying.value = !isPlaying.value;
                    if (isPlaying.value) {
                        bgMusic.value.play().catch(err => {
                            console.log('播放失败:', err);
                            isPlaying.value = false;
                        });
                    } else {
                        bgMusic.value.pause();
                    }
                };

                // 点击电脑区域交互
                const handleComputerClick = () => {
                    window.location.href = "../start4/index.html";
                };

                return {
                    isPlaying,
                    bgMusic,
                    goBack,
                    toggleMusic,
                    handleComputerClick
                };
            }
        }).mount('#app');
    </script>
</body>

</html>